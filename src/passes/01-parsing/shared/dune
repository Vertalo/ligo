;; Build of the lexer in common to all Ligo's dialects

(ocamllex Lexer)

;; Build of the lexer as a library

(library
  (name lexer_shared)
  (public_name ligo.lexer.shared)
  (libraries
    ;; Ligo
    simple-utils
    ;; Vendors
    Preprocessor
    ;; Third party
    uutf
    getopt
    zarith)
  (modules
    LexerLib
    LexerUnit
    Lexer
    LexerLog
    Markup
    EvalOpt
    Version)
  (preprocess
   (pps bisect_ppx --conditional)))

;; Build of the parser as a library

(library
  (name parser_shared)
  (public_name ligo.parser.shared)
  (libraries
    ;; Ligo
    lexer_shared
    simple-utils
    ;; Third party
    menhirLib)
  (modules
    ParserUnit
    ParserAPI)
  (preprocess
    (pps bisect_ppx --conditional)))
;;  (flags (:standard -open Lexer_shared)))

;; Build of the version source (for the user, as a CLI option)

(rule
  (targets Version.ml)
  (action
    (progn (run "sh" "-c" "printf 'let version = \"%s\"'\\\\n \"$(echo UNKNOWN)\" > Version.ml")))
  (mode (promote (until-clean) (only *))))
